<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
         body {
            margin: 0;
            padding: 0;
        }
        .main {
            min-height: 100vh;
            width: 100%;
            background-color: black;
            background-image: url("https://s1.hostingkartinok.com/uploads/images/2021/10/244a65611378a3c42d9beb9f57bfbfb1.png");
            display: flex;
            justify-content: center;
            transition: background 1.5s ease-out 0s;
        }
       .wrapper {
            width: 65vw;
            display: flex;
            justify-content: space-evenly;
            overflow-y: hidden;
        }
        .block {
            width: 15vw;
            height: 15vw;
            align-self: center;
            background: rgba(255, 255, 255, 0.5);
            transform: translateY(60vh);
            transition: transform 0.5s ease-out 0s, rotate 0.3s ease-out 0s;
        }
        .block2 {
            transform: translateY(65vh);
        }
        .block3 {
            transform: translateY(70vh);
        }
    </style>
</head>
<body>
    <div class = "main" id = "main">
        <div class = "wrapper">
            <div class = "block block1"></div>
            <div class = "block block2"></div>
            <div class = "block block3"></div>
        </div>
    </div>
    <script>
        class Blocks {

            constructor(parent) {
                this.parent = parent;
                this.block1 = this.parent.getElementsByClassName("block")[0];
                this.block2 = this.parent.getElementsByClassName("block")[1];
                this.block3 = this.parent.getElementsByClassName("block")[2];
                this.addEvents();
                this.progress1 = 60;
                this.progress2 = 65;
                this.progress3 = 70;
                this.progrRotate1 = 0;
                this.progrRotate2 = 0;
                this.progrRotate3 = 0;
                this.bgPosition = 0;
                this.check = false;
                this.count = 0;
                this.rotatedAll = false;
                this.touchSt = 0;
                this.touchEnd = 0;
                this.touchMove = 0;
            }

            addEvents() {
                this.parent.addEventListener("wheel", (e) => {
                    if(this.check == false) {
                        this.scrollBG(e.deltaY);
                    }
                    this.transfBlocks(e.deltaY);
                });
                this.parent.addEventListener("scroll", (e) => {
                    if(this.check == false) {
                        this.scrollBG(e.deltaY);
                    }
                    this.transfBlocks(e.deltaY);
                });
            }
            transfBlocks(scroll) {
                if(scroll > 0) {
                    if(this.progress1 > 24) {
                        this.progress1 -= 9;
                        this.progress2 -= 10;
                        this.progress3 -= 11;

                        this.block1.style.transform = `translateY(${this.progress1}vh)`;
                        this.block2.style.transform = `translateY(${this.progress2}vh)`;
                        this.block3.style.transform = `translateY(${this.progress3}vh)`;
                    } else if(this.progress1 == 24) {
                        this.progress1 = 20;
                        this.progress2 = 20;
                        this.progress3 = 20;

                        this.block1.style.transform = `translateY(20vh)`;
                        this.block2.style.transform = `translateY(20vh)`;
                        this.block3.style.transform = `translateY(20vh)`;
                    } else if(this.progress1 <= 20 && this.progress1 > 0) {
                        this.progress1 -= 5;
                        this.progress2 -= 5;
                        this.progress3 -= 5;

                        this.block1.style.transform = `translateY(${this.progress1}vh)`;
                        this.block2.style.transform = `translateY(${this.progress2}vh)`;
                        this.block3.style.transform = `translateY(${this.progress3}vh)`;
                    } else if(this.progress1 == 0 && this.progrRotate1 < 90) {
                        this.check = true;
                        this.rotateBlock(1, "forward");
                    } else if(this.progrRotate1 == 90 && this.progrRotate2 < 90) {
                        this.rotateBlock(2, "forward");
                    } else if(this.progrRotate1 == 90 && this.progrRotate1 == 90 && this.progrRotate3 < 90) {
                        this.rotateBlock(3, "forward");
                        this.rotatedAll = true;
                    } else if(this.rotatedAll = true && this.progress1 > -60) {
                        this.check = false;
                        this.progress1 -= 10;
                        this.progress2 -= 10;
                        this.progress3 -= 10;

                        this.block1.style.transform = `translateY(${this.progress1}vh) rotate(90deg)`;
                        this.block2.style.transform = `translateY(${this.progress2}vh) rotate(90deg)`;
                        this.block3.style.transform = `translateY(${this.progress3}vh) rotate(90deg)`;

                    } else {
                        this.check = true;
                        this.rotatedAll = false;
                    }
                } else if(scroll < 0) {
                    if(this.progress1 <= -10) {
                        this.check = false;
                        this.progress1 += 10;
                        this.progress2 += 10;
                        this.progress3 += 10;

                        this.block1.style.transform = `translateY(${this.progress1}vh) rotate(90deg)`;
                        this.block2.style.transform = `translateY(${this.progress2}vh) rotate(90deg)`;
                        this.block3.style.transform = `translateY(${this.progress3}vh) rotate(90deg)`;

                    } else if(this.progrRotate1 == 90 && this.progrRotate2 == 90 && this.progrRotate3 >= 15) {
                        this.check = true;
                        this.rotateBlock(3, "back");
                    } else if(this.progrRotate1 == 90 && this.progrRotate2 >= 15 && this.progrRotate3 == 0) {
                        this.rotateBlock(2, "back");
                    } else if(this.progrRotate1 >= 15 && this.progrRotate2 == 0 && this.progrRotate3 == 0) {
                        this.rotateBlock(1, "back");
                        this.rotatedAll = true;
                    } else if(this.progress1 < 20) {
                        this.progress1 += 5;
                        this.progress2 += 5;
                        this.progress3 += 5;

                        this.block1.style.transform = `translateY(${this.progress1}vh)`;
                        this.block2.style.transform = `translateY(${this.progress2}vh)`;
                        this.block3.style.transform = `translateY(${this.progress3}vh)`;
                    } else if(this.progress1 == 20) {
                        this.progress1 = 24;
                        this.progress2 = 25;
                        this.progress3 = 26;

                        this.block1.style.transform = `translateY(24vh)`;
                        this.block2.style.transform = `translateY(25vh)`;
                        this.block3.style.transform = `translateY(26vh)`;
                    } else if(this.progress1 <= 51) {
                        this.progress1 += 9;
                        this.progress2 += 10;
                        this.progress3 += 11;

                        this.block1.style.transform = `translateY(${this.progress1}vh)`;
                        this.block2.style.transform = `translateY(${this.progress2}vh)`;
                        this.block3.style.transform = `translateY(${this.progress3}vh)`;
                    } else {
                        this.check = true;
                    }
                }
            }
            scrollBG(scroll) {
                if(scroll > 0) {
                    this.bgPosition -= 50;
                    this.count++;
                } else {
                    this.bgPosition += 50;
                    this.count--;
                }
                this.parent.style.backgroundPositionY = this.bgPosition + "px";
            }
            rotateBlock(num, direction) {
                if(direction == "forward") {
                    this["progrRotate" + num] += 15;
                    this["block" + num].style.transform = `translateY(0vh) rotate(${+this["progrRotate" + num]}deg)`;
                } else {
                    this["progrRotate" + num] -= 15;
                    this["block" + num].style.transform = `translateY(0vh) rotate(${+this["progrRotate" + num]}deg)`;
                }
            }
        }

        const main = document.getElementById("main");
        let a = new Blocks(main);
    </script>
</body>
</html>
